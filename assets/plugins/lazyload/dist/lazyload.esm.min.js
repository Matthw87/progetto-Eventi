const e="undefined"!=typeof window,t=e&&!("onscroll"in window)||"undefined"!=typeof navigator&&/(gle|ing|ro)bot|crawl|spider/i.test(navigator.userAgent),a=e&&"IntersectionObserver"in window,l=e&&"classList"in document.createElement("p"),s={elements_selector:"img",container:t||e?document:null,threshold:300,thresholds:null,data_src:"src",data_srcset:"srcset",data_sizes:"sizes",data_bg:"bg",data_bg_multi:"bg-multi",data_poster:"poster",class_applied:"applied",class_loading:"loading",class_loaded:"loaded",class_error:"error",load_delay:0,auto_unobserve:!0,callback_enter:null,callback_exit:null,callback_applied:null,callback_loading:null,callback_loaded:null,callback_error:null,callback_finish:null,use_native:!1},o=e=>Object.assign({},s,e),n=function(e,t){var a;let l=new e(t);try{a=new CustomEvent("LazyLoad::Initialized",{detail:{instance:l}})}catch(e){(a=document.createEvent("CustomEvent")).initCustomEvent("LazyLoad::Initialized",!1,!1,{instance:l})}window.dispatchEvent(a)},r=(e,t)=>e.getAttribute("data-"+t),i=(e,t,a)=>{var l="data-"+t;null!==a?e.setAttribute(l,a):e.removeAttribute(l)},c=(e,t)=>i(e,"ll-status",t),d=(e,t)=>i(e,"ll-timeout",t),u=e=>r(e,"ll-timeout"),_=(e,t,a,l)=>{e&&(void 0===l?void 0===a?e(t):e(t,a):e(t,a,l))},g=(e,t)=>{l?e.classList.add(t):e.className+=(e.className?" ":"")+t},b=(e,t)=>{l?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\s+)"+t+"(\\s+|$)")," ").replace(/^\s+/,"").replace(/\s+$/,"")},h=e=>e.llTempImage,m=e=>{e&&(e.loadingCount+=1)},p=e=>{let t=[];for(let a,l=0;a=e.children[l];l+=1)"SOURCE"===a.tagName&&t.push(a);return t},v=(e,t,a)=>{a&&e.setAttribute(t,a)},f=(e,t)=>{v(e,"sizes",r(e,t.data_sizes)),v(e,"srcset",r(e,t.data_srcset)),v(e,"src",r(e,t.data_src))},E={IMG:(e,t)=>{const a=e.parentNode;if(a&&"PICTURE"===a.tagName){p(a).forEach(e=>{f(e,t)})}f(e,t)},IFRAME:(e,t)=>{v(e,"src",r(e,t.data_src))},VIDEO:(e,t)=>{p(e).forEach(e=>{v(e,"src",r(e,t.data_src))}),v(e,"poster",r(e,t.data_poster)),v(e,"src",r(e,t.data_src)),e.load()}},I=(e,t,a)=>{const l=E[e.tagName];l&&(l(e,t),m(a),g(e,t.class_loading),c(e,"loading"),_(t.callback_loading,e,a),_(t.callback_reveal,e,a))},k=["IMG","IFRAME","VIDEO"],y=(e,t)=>{!t||t.toLoadCount||t.loadingCount||_(e.callback_finish,t)},w=(e,t,a)=>{e.addEventListener(t,a)},L=(e,t,a)=>{e.removeEventListener(t,a)},C=(e,t,a)=>{L(e,"load",t),L(e,"loadeddata",t),L(e,"error",a)},A=(e,t,a)=>{(e=>{delete e.llTempImage})(e),((e,t)=>{t&&(t.loadingCount-=1)})(0,a),b(e,t.class_loading)},z=(e,t,a)=>{const l=h(e)||e,s=n=>{((e,t,a,l)=>{A(t,a,l),g(t,a.class_loaded),c(t,"loaded"),_(a.callback_loaded,t,l),y(a,l)})(0,e,t,a),C(l,s,o)},o=n=>{((e,t,a,l)=>{A(t,a,l),g(t,a.class_error),c(t,"error"),_(a.callback_error,t,l),y(a,l)})(0,e,t,a),C(l,s,o)};((e,t,a)=>{w(e,"load",t),w(e,"loadeddata",t),w(e,"error",a)})(l,s,o)},N=(e,t)=>{t&&(t.toLoadCount-=1)},O=(e,t,a)=>{(e=>{e.llTempImage=document.createElement("img")})(e),z(e,t,a),((e,t,a)=>{const l=r(e,t.data_bg);l&&(e.style.backgroundImage=`url("${l}")`,h(e).setAttribute("src",l),m(a),g(e,t.class_loading),c(e,"loading"),_(t.callback_loading,e,a),_(t.callback_reveal,e,a))})(e,t,a),((e,t,a)=>{const l=r(e,t.data_bg_multi);l&&(e.style.backgroundImage=l,g(e,t.class_applied),c(e,"applied"),_(t.callback_applied,e,a))})(e,t,a)},M=(e,t,a)=>{(e=>k.indexOf(e.tagName)>-1)(e)?((e,t,a)=>{z(e,t,a),I(e,t,a)})(e,t,a):O(e,t,a),N(0,a),((e,t)=>{if(!t)return;const a=t._observer;a&&t._settings.auto_unobserve&&a.unobserve(e)})(e,a),y(t,a)},x=e=>{var t=u(e);t&&(clearTimeout(t),d(e,null))},R=(e,t,a)=>{const l=a._settings;_(l.callback_enter,e,t,a),l.load_delay?((e,t,a)=>{const l=t.load_delay;let s=u(e);s||(s=setTimeout((function(){M(e,t,a),x(e)}),l),d(e,s))})(e,l,a):M(e,l,a)},T=["IMG","IFRAME"],F=e=>e.use_native&&"loading"in HTMLImageElement.prototype,G=(e,t,a)=>{e.forEach(e=>{-1!==T.indexOf(e.tagName)&&(e.setAttribute("loading","lazy"),((e,t,a)=>{z(e,t,a),I(e,t,a),N(0,a),c(e,"native"),y(t,a)})(e,t,a))}),a.toLoadCount=0},$=(e,t)=>{(e=>{e.disconnect()})(e),((e,t)=>{t.forEach(t=>{e.observe(t),c(t,"observed")})})(e,t)},D=e=>{var t;a&&!F(e._settings)&&(e._observer=new IntersectionObserver(t=>{t.forEach(t=>(e=>e.isIntersecting||e.intersectionRatio>0)(t)?R(t.target,t,e):((e,t,a)=>{const l=a._settings;_(l.callback_exit,e,t,a),l.load_delay&&x(e)})(t.target,t,e))},{root:(t=e._settings).container===document?null:t.container,rootMargin:t.thresholds||t.threshold+"px"}))},S=e=>Array.prototype.slice.call(e),U=e=>e.container.querySelectorAll(e.elements_selector),V=e=>!(e=>null!==r(e,"ll-status"))(e)||(e=>"observed"===r(e,"ll-status"))(e),j=e=>(e=>"error"===r(e,"ll-status"))(e),q=(e,t)=>(e=>S(e).filter(V))(e||U(t)),H=e=>{const t=e._settings;var a;(a=U(t),S(a).filter(j)).forEach(e=>{b(e,t.class_error),(e=>{i(e,"ll-status",null)})(e)}),e.update()},P=function(t,a){var l;this._settings=o(t),this.loadingCount=0,D(this),l=this,e&&window.addEventListener("online",e=>{H(l)}),this.update(a)};P.prototype={update:function(e){const l=this._settings,s=q(e,l);this.toLoadCount=s.length,!t&&a?F(l)?G(s,l,this):$(this._observer,s):this.loadAll(s)},destroy:function(){this._observer&&this._observer.disconnect(),delete this._observer,delete this._settings,delete this.loadingCount,delete this.toLoadCount},loadAll:function(e){const t=this._settings;q(e,t).forEach(e=>{M(e,t,this)})},load:function(e){M(e,this._settings,this)}},P.load=(e,t)=>{const a=o(t);M(e,a)},e&&((e,t)=>{if(t)if(t.length)for(let a,l=0;a=t[l];l+=1)n(e,a);else n(e,t)})(P,window.lazyLoadOptions);export default P;
